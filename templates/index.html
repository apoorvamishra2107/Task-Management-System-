<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

</head>
<body>
    <div class="container">
        <header>
            <h1>üìù Task Manager</h1>
            <p class="subtitle">Organize your work efficiently</p>
        </header>

        <!-- Add Task Form -->
        <div class="add-task-section">
            <h2>Add New Task</h2>
            <form id="taskForm">
                <div class="form-group">
                    <input type="text" id="taskTitle" placeholder="Task title *" required>
                </div>
                <div class="form-group">
                    <textarea id="taskDescription" placeholder="Task description" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <select id="taskPriority">
                        <option value="low">Low Priority</option>
                        <option value="medium" selected>Medium Priority</option>
                        <option value="high">High Priority</option>
                    </select>
                    <select id="taskStatus">
                        <option value="pending" selected>Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Add Task</button>
            </form>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <button class="filter-btn active" onclick="filterTasks('all')">All</button>
            <button class="filter-btn" onclick="filterTasks('pending')">Pending</button>
            <button class="filter-btn" onclick="filterTasks('in-progress')">In Progress</button>
            <button class="filter-btn" onclick="filterTasks('completed')">Completed</button>
        </div>

        <!-- Tasks Display -->
        <div class="tasks-section">
            <h2>Your Tasks <span id="taskCount" class="badge">0</span></h2>
            <div id="tasksList"></div>
            <div id="emptyState" class="empty-state">
                <p>No tasks yet. Create your first task above! üöÄ</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api/tasks';
        let currentFilter = 'all';
        let editingTaskId = null;

        // Load tasks on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadTasks();
        });

        // Form submission
        document.getElementById('taskForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const priority = document.getElementById('taskPriority').value;
            const status = document.getElementById('taskStatus').value;

            if (editingTaskId) {
                await updateTask(editingTaskId, { title, description, priority, status });
                editingTaskId = null;
                document.querySelector('.btn-primary').textContent = 'Add Task';
            } else {
                await createTask({ title, description, priority, status });
            }

            document.getElementById('taskForm').reset();
            loadTasks();
        });

        // Create new task
        async function createTask(taskData) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(taskData)
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification('Task created successfully!', 'success');
                }
            } catch (error) {
                showNotification('Error creating task', 'error');
                console.error('Error:', error);
            }
        }

        // Load all tasks
        async function loadTasks() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                if (data.success) {
                    displayTasks(data.tasks);
                }
            } catch (error) {
                showNotification('Error loading tasks', 'error');
                console.error('Error:', error);
            }
        }

        // Display tasks
        function displayTasks(tasks) {
            const tasksList = document.getElementById('tasksList');
            const emptyState = document.getElementById('emptyState');
            const taskCount = document.getElementById('taskCount');

            // Filter tasks
            let filteredTasks = tasks;
            if (currentFilter !== 'all') {
                filteredTasks = tasks.filter(task => task.status === currentFilter);
            }

            taskCount.textContent = filteredTasks.length;

            if (filteredTasks.length === 0) {
                tasksList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            tasksList.innerHTML = filteredTasks.map(task => `
                <div class="task-card ${task.status}" data-priority="${task.priority}">
                    <div class="task-header">
                        <h3>${task.title}</h3>
                        <span class="priority-badge ${task.priority}">${task.priority}</span>
                    </div>
                    <p class="task-description">${task.description || 'No description'}</p>
                    <div class="task-meta">
                        <span class="status-badge ${task.status}">${task.status}</span>
                        <span class="task-date">Created: ${new Date(task.created_at).toLocaleDateString()}</span>
                    </div>
                    <div class="task-actions">
                        <button onclick="editTask(${task.id})" class="btn-edit">Edit</button>
                        <button onclick="toggleStatus(${task.id}, '${task.status}')" class="btn-toggle">
                            ${task.status === 'completed' ? 'Reopen' : 'Complete'}
                        </button>
                        <button onclick="deleteTask(${task.id})" class="btn-delete">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Edit task
        async function editTask(id) {
            try {
                const response = await fetch(`${API_URL}/${id}`);
                const data = await response.json();
                
                if (data.success) {
                    const task = data.task;
                    document.getElementById('taskTitle').value = task.title;
                    document.getElementById('taskDescription').value = task.description;
                    document.getElementById('taskPriority').value = task.priority;
                    document.getElementById('taskStatus').value = task.status;
                    
                    editingTaskId = id;
                    document.querySelector('.btn-primary').textContent = 'Update Task';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            } catch (error) {
                showNotification('Error loading task', 'error');
                console.error('Error:', error);
            }
        }

        // Update task
        async function updateTask(id, taskData) {
            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(taskData)
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification('Task updated successfully!', 'success');
                }
            } catch (error) {
                showNotification('Error updating task', 'error');
                console.error('Error:', error);
            }
        }

        // Toggle task status
        async function toggleStatus(id, currentStatus) {
            const newStatus = currentStatus === 'completed' ? 'pending' : 'completed';
            await updateTask(id, { status: newStatus });
            loadTasks();
        }

        // Delete task
        async function deleteTask(id) {
            if (!confirm('Are you sure you want to delete this task?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification('Task deleted successfully!', 'success');
                    loadTasks();
                }
            } catch (error) {
                showNotification('Error deleting task', 'error');
                console.error('Error:', error);
            }
        }

        // Filter tasks
        function filterTasks(status) {
            currentFilter = status;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadTasks();
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>